<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>NextStep.AI - Feedback</title>

  <!-- Shared styles + page styles -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/result.css') }}">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
        rel="stylesheet">
</head>
<body class="landing-body">
  {% include "navbar.html" %}

  <main>
    <section class="result-section">
      <div class="app-shell">
        <div class="card result-card">
          {% if result.error %}
            <h1 class="result-title">Feedback</h1>
            <p class="error">{{ result.error }}</p>
          {% else %}
            <header class="result-header">
              <div>
                <h1 class="result-title">Interview feedback</h1>
                <p class="subtitle">Automatic evaluation from NextStep.AI.</p>
              </div>
            </header>

            <div class="result-body">

              <section class="result-block">
                <h2 class="section-title">Question</h2>
                <p class="result-text result-question">{{ result.question }}</p>
              </section>

              <section class="result-block">
                <h2 class="section-title">Your answer</h2>
                <p class="result-text result-answer">{{ result.user_answer }}</p>
              </section>

              <section class="result-block">
                <h2 class="section-title">Scores</h2>
                <div class="scores">
                  <div>Relevance: <span class="score-pill">{{ result.relevance_score }}</span></div>
                  <div>Confidence: <span class="score-pill">{{ result.confidence_score }}</span></div>
                  <div>Final: <span class="score-pill">{{ result.final_score }}</span></div>
                </div>
              </section>

              <section class="result-block">
                <h2 class="section-title">Feedback</h2>

                {# Parse strengths and improvements from the feedback_text string #}
                {% set raw = result.feedback_text or "" %}
                {% set parts = raw.split("Improvements:") %}
                {% set strengths_part = parts[0] %}
                {% set improvements_part = parts[1] if parts|length > 1 else "" %}

                {% set strengths_clean = strengths_part.replace("Strengths:", "").strip() %}
                {% set improvements_clean = improvements_part.strip() %}

                {% set strengths_items = strengths_clean.split(";") if strengths_clean else [] %}
                {% set improvements_items = improvements_clean.split(";") if improvements_clean else [] %}

                <div class="feedback-grid">
                  {% if strengths_items %}
                    <div class="feedback-section feedback-strengths">
                      <h3>Strengths</h3>
                      <ul>
                        {% for item in strengths_items %}
                          {% if item.strip() %}
                            <li>{{ item.strip() }}</li>
                          {% endif %}
                        {% endfor %}
                      </ul>
                    </div>
                  {% endif %}

                  {% if improvements_items %}
                    <div class="feedback-section feedback-improvements">
                      <h3>Improvements</h3>
                      <ul>
                        {% for item in improvements_items %}
                          {% if item.strip() %}
                            <li>{{ item.strip() }}</li>
                          {% endif %}
                        {% endfor %}
                      </ul>
                    </div>
                  {% endif %}
                </div>

                {# Fallback: if parsing failed and everything was empty, show the raw text #}
                {% if not strengths_items and not improvements_items and result.feedback_text %}
                  <p class="result-text">{{ result.feedback_text }}</p>
                {% endif %}
              </section>
            </div>
          {% endif %}

          <a href="{{ url_for('index') }}" class="back-link">Back to question</a>
        </div>
      </div>
    </section>
  </main>

  <footer class="landing-footer">
    <p>Â© {{ current_year or "2025" }} NextStep.AI. All rights reserved.</p>
  </footer>
</body>
</html>
