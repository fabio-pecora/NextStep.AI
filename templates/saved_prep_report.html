<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Prep report – {{ prep_report.job_title }}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/saved_prep_report.css') }}">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body class="prep-view-body">
  {% include "navbar.html" %}

  <main class="prep-view-main">
    <div class="prep-view-header-row">
      <div>
        <h1 class="prep-title">
          Prep report for {{ prep_report.job_title }}
          {% if prep_report.company_name %}
            <span class="muted"> · {{ prep_report.company_name }}</span>
          {% endif %}
        </h1>
        <p class="prep-subtitle">
          A focused interview guide with questions, examples, and next steps tailored to
          <strong>{{ prep_report.job_title }}</strong>
          {% if prep_report.company_name %} at <strong>{{ prep_report.company_name }}</strong>{% endif %}.
          {% if prep_report.created_at %}
            <span class="gen-date">Generated on {{ prep_report.created_at.strftime("%Y-%m-%d") }}</span>
          {% endif %}
        </p>
      </div>

      <div class="prep-view-actions">
        <a class="btn btn-outline prep-back-link" href="{{ url_for('profile') }}">Back to profile</a>
        <a class="btn btn-primary" href="{{ url_for('download_saved_prep_report_pdf', report_id=prep_report.id) }}">
          Download as PDF
        </a>
      </div>
    </div>

    <!-- Pretty report body, same structure as the popup -->
    <section class="report-card">
      <header class="report-header">
        <div class="report-logo-mark">
          <div class="report-logo-text">NextStep.<span>AI</span></div>
          <div class="report-logo-tagline">Interview preparation report</div>
        </div>

        <div class="report-meta">
          <p class="report-job">
            {{ prep_report.job_title }}
            {% if prep_report.company_name %} · {{ prep_report.company_name }}{% endif %}
          </p>
          {% if report.candidate_name %}
            <p class="report-candidate">Prepared for {{ report.candidate_name }}</p>
          {% endif %}
          <div class="report-tags">
            <span class="report-tag">AI generated</span>
            {% if prep_report.company_name %}
              <span class="report-tag">Company specific</span>
            {% endif %}
            <span class="report-tag">
              {% if report.mode == "role_and_company" %}
                Role and company insights
              {% else %}
                Role focused prep
              {% endif %}
            </span>
            {% if report.debug_note %}
              <span class="report-tag report-tag-warning">Fallback mode</span>
            {% endif %}
          </div>
        </div>
      </header>

      <div class="report-body" id="report-content">
        {% if report.debug_note %}
          <p class="report-debug-note">{{ report.debug_note }}</p>
        {% endif %}

        {# SECTION 1 #}
        {% set know = report.know_all_about_them or {} %}
        {% if know.mission_values or know.culture_snapshot or know.recent_projects_news or know.competitors_industry_trends %}
          <section class="report-section">
            <h3 class="report-heading">1. Know their world</h3>

            {% if know.mission_values %}
              <h4 class="report-subheading">Mission and values</h4>
              {% for item in know.mission_values %}
                <p class="report-paragraph">• {{ item }}</p>
              {% endfor %}
            {% endif %}

            {% if know.culture_snapshot %}
              <h4 class="report-subheading">Culture snapshot</h4>
              {% for item in know.culture_snapshot %}
                <p class="report-paragraph">• {{ item }}</p>
              {% endfor %}
            {% endif %}

            {% if know.recent_projects_news %}
              <h4 class="report-subheading">Recent projects and news</h4>
              {% for item in know.recent_projects_news %}
                <p class="report-paragraph">• {{ item }}</p>
              {% endfor %}
            {% endif %}

            {% if know.competitors_industry_trends %}
              <h4 class="report-subheading">Competitors and industry trends</h4>
              {% for item in know.competitors_industry_trends %}
                <p class="report-paragraph">• {{ item }}</p>
              {% endfor %}
            {% endif %}
          </section>
        {% endif %}

        {# SECTION 2 #}
        {% set fit = report.perfect_fit_map or {} %}
        {% if fit.top_strengths or fit.best_projects %}
          <section class="report-section">
            <h3 class="report-heading">2. Your perfect fit map</h3>

            {% if fit.top_strengths %}
              <h4 class="report-subheading">Strengths to lean into</h4>
              {% for s in fit.top_strengths %}
                <p class="report-paragraph">• {{ s }}</p>
              {% endfor %}
            {% endif %}

            {% if fit.best_projects %}
              <h4 class="report-subheading">Projects to spotlight</h4>
              {% for proj in fit.best_projects %}
                <p class="report-paragraph"><strong>{{ proj.title }}</strong>{% if proj.summary %} - {{ proj.summary }}{% endif %}</p>
              {% endfor %}
            {% endif %}
          </section>
        {% endif %}

        {# SECTION 3 #}
        {% set beh = report.behavioral_practice or {} %}
        {% if beh.questions or beh.example_answers %}
          <section class="report-section">
            <h3 class="report-heading">3. Behavioral interview practice</h3>

            {% if beh.questions %}
              <h4 class="report-subheading">Questions to prepare for</h4>
              {% for q in beh.questions %}
                <p class="report-paragraph">• {{ q }}</p>
              {% endfor %}
            {% endif %}

            {% if beh.example_answers %}
              <h4 class="report-subheading">Sample STAR answers</h4>
              {% for ex in beh.example_answers %}
                <div class="report-example-block">
                  <p class="report-example-question">{{ ex.question }}</p>
                  <p class="report-example-answer">{{ ex.answer }}</p>
                  {% if ex.legend %}
                    <p class="report-legend">
                      Legend:
                      {% for key, val in ex.legend.items() %}
                        <span>{{ key }} {{ val }}</span>
                      {% endfor %}
                    </p>
                  {% endif %}
                </div>
              {% endfor %}
            {% endif %}
          </section>
        {% endif %}

        {# SECTION 4 #}
        {% set tech = report.technical_prep or {} %}
        {% if tech.questions or tech.example_answers or tech.key_concepts or tech.red_flags %}
          <section class="report-section">
            <h3 class="report-heading">4. Technical or role specific preparation</h3>

            {% if tech.questions %}
              <h4 class="report-subheading">Questions they may ask you</h4>
              {% for q in tech.questions %}
                <p class="report-paragraph">• {{ q }}</p>
              {% endfor %}
            {% endif %}

            {% if tech.example_answers %}
              <h4 class="report-subheading">Example responses</h4>
              {% for ex in tech.example_answers %}
                <div class="report-example-block">
                  <p class="report-example-question">{{ ex.question }}</p>
                  <p class="report-example-answer">{{ ex.answer }}</p>
                </div>
              {% endfor %}
            {% endif %}

            {% if tech.key_concepts %}
              <h4 class="report-subheading">Key concepts to review</h4>
              {% for item in tech.key_concepts %}
                <p class="report-paragraph">• {{ item }}</p>
              {% endfor %}
            {% endif %}

            {% if tech.red_flags %}
              <h4 class="report-subheading">Common red flags to avoid</h4>
              {% for item in tech.red_flags %}
                <p class="report-paragraph">• {{ item }}</p>
              {% endfor %}
            {% endif %}
          </section>
        {% endif %}

        {# SECTION 5 #}
        {% set imp = report.improvement_zone or {} %}
        {% if imp.skill_gaps or imp.soft_skills or imp.learning_focus %}
          <section class="report-section">
            <h3 class="report-heading">5. Upgrade yourself before the interview</h3>

            {% if imp.skill_gaps %}
              <h4 class="report-subheading">Skill gaps to work on</h4>
              {% for item in imp.skill_gaps %}
                <p class="report-paragraph">• {{ item }}</p>
              {% endfor %}
            {% endif %}

            {% if imp.soft_skills %}
              <h4 class="report-subheading">Soft skills to sharpen</h4>
              {% for item in imp.soft_skills %}
                <p class="report-paragraph">• {{ item }}</p>
              {% endfor %}
            {% endif %}

            {% if imp.learning_focus %}
              <h4 class="report-subheading">Focus for this week</h4>
              {% for item in imp.learning_focus %}
                <p class="report-paragraph">• {{ item }}</p>
              {% endfor %}
            {% endif %}
          </section>
        {% endif %}

        {# SECTION 6 #}
        {% set itm = report.impress_them_back or {} %}
        {% if itm.team_culture or itm.impact_growth or itm.technical_depth or itm.company_direction or itm.next_steps %}
          <section class="report-section">
            <h3 class="report-heading">6. Smart questions to ask them</h3>

            {% if itm.team_culture %}
              <h4 class="report-subheading">Team and culture</h4>
              {% for q in itm.team_culture %}
                <p class="report-paragraph">• {{ q }}</p>
              {% endfor %}
            {% endif %}

            {% if itm.impact_growth %}
              <h4 class="report-subheading">Impact and growth</h4>
              {% for q in itm.impact_growth %}
                <p class="report-paragraph">• {{ q }}</p>
              {% endfor %}
            {% endif %}

            {% if itm.technical_depth %}
              <h4 class="report-subheading">Technical depth</h4>
              {% for q in itm.technical_depth %}
                <p class="report-paragraph">• {{ q }}</p>
              {% endfor %}
            {% endif %}

            {% if itm.company_direction %}
              <h4 class="report-subheading">Company direction</h4>
              {% for q in itm.company_direction %}
                <p class="report-paragraph">• {{ q }}</p>
              {% endfor %}
            {% endif %}

            {% if itm.next_steps %}
              <h4 class="report-subheading">Next steps</h4>
              {% for q in itm.next_steps %}
                <p class="report-paragraph">• {{ q }}</p>
              {% endfor %}
            {% endif %}
          </section>
        {% endif %}
      </div>
    </section>
  </main>

  <footer class="landing-footer">
    <p>© {{ current_year or "2025" }} NextStep.AI. All rights reserved.</p>
  </footer>
</body>
</html>
