<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Prep report - {{ prep_report.job_title }}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/saved_prep_report.css') }}">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body class="prep-view-body">
  {% include "navbar.html" %}

  <main class="prep-view-main">

    <div class="prep-view-header-row">
      <div>
        <h1 class="prep-title">
          Prep report for {{ prep_report.job_title }}
          {% if prep_report.company_name %}
            <span class="muted"> ¬∑ {{ prep_report.company_name }}</span>
          {% endif %}
        </h1>
        <p class="prep-subtitle">
          A focused, structured interview guide designed to help you stand out.
          {% if prep_report.created_at %}
            <span class="gen-date">Generated on {{ prep_report.created_at.strftime("%Y-%m-%d") }}</span>
          {% endif %}
        </p>
      </div>

      <div class="prep-view-actions">
        <a class="prep-back-link" href="{{ url_for('profile') }}">Back to profile</a>
        <a class="btn btn-primary" href="{{ url_for('download_saved_prep_report_pdf', report_id=prep_report.id) }}">
          Download PDF
        </a>
      </div>
    </div>

    <section class="report-card">
      <header class="report-header">
        <div class="report-logo-mark">
          <div class="report-logo-text">NextStep.<span>AI</span></div>
          <div class="report-logo-tagline">Interview preparation report</div>
        </div>

        {% set report = report or prep_report.report_json or {} %}

        <div class="report-meta">
          <p class="report-job">
            {{ prep_report.job_title }}
            {% if prep_report.company_name %} ¬∑ {{ prep_report.company_name }}{% endif %}
          </p>

          {% set candidate = report.candidate_name or prep_report.candidate_name %}
          {% if candidate %}
            <p class="report-candidate">Prepared for {{ candidate }}</p>
          {% endif %}

          <div class="report-tags">
            <span class="report-tag">AI generated</span>
            {% if prep_report.company_name %}
              <span class="report-tag">Company specific</span>
            {% endif %}
            <span class="report-tag">
              {% if report.mode == "role_and_company" %}
                Role and company insights
              {% else %}
                Role focused prep
              {% endif %}
            </span>
            {% if report.debug_note %}
              <span class="report-tag report-tag-warning">Fallback mode</span>
            {% endif %}
          </div>
        </div>
      </header>

      {% set know = report.know_all_about_them or {} %}
      {% set fit = report.perfect_fit_map or {} %}
      {% set beh = report.behavioral_practice or {} %}
      {% set tech = report.technical_prep or {} %}
      {% set imp = report.improvement_zone or {} %}
      {% set itm = report.impress_them_back or {} %}

      {% set know_count = (know.mission_values|length if know.mission_values else 0)
                        + (know.culture_snapshot|length if know.culture_snapshot else 0)
                        + (know.recent_projects_news|length if know.recent_projects_news else 0)
                        + (know.competitors_industry_trends|length if know.competitors_industry_trends else 0) %}

      {% set fit_count = (fit.top_strengths|length if fit.top_strengths else 0)
                       + (fit.best_projects|length if fit.best_projects else 0) %}

      {% set beh_count = (beh.questions|length if beh.questions else 0)
                       + (beh.example_answers|length if beh.example_answers else 0) %}

      {% set tech_count = (tech.questions|length if tech.questions else 0)
                        + (tech.example_answers|length if tech.example_answers else 0)
                        + (tech.key_concepts|length if tech.key_concepts else 0)
                        + (tech.red_flags|length if tech.red_flags else 0) %}

      {% set imp_count = (imp.skill_gaps|length if imp.skill_gaps else 0)
                       + (imp.soft_skills|length if imp.soft_skills else 0)
                       + (imp.learning_focus|length if imp.learning_focus else 0) %}

      {% set ask_count = (itm.team_culture|length if itm.team_culture else 0)
                       + (itm.impact_growth|length if itm.impact_growth else 0)
                       + (itm.technical_depth|length if itm.technical_depth else 0)
                       + (itm.company_direction|length if itm.company_direction else 0)
                       + (itm.next_steps|length if itm.next_steps else 0) %}

      <div class="report-body" id="report-content">

        {% if report.debug_note %}
          <p class="report-debug-note">{{ report.debug_note }}</p>
        {% endif %}

        <section class="tldr-card">
          <div class="tldr-top">
            <div class="tldr-title">
              <div class="tldr-badge">TLDR</div>
              <h2 class="tldr-h">Your game plan</h2>
            </div>
            <div class="tldr-meta">
              <div class="tldr-meta-row">
                <span class="tldr-k">Role</span>
                <span class="tldr-v">{{ prep_report.job_title }}</span>
              </div>
              {% if prep_report.company_name %}
              <div class="tldr-meta-row">
                <span class="tldr-k">Company</span>
                <span class="tldr-v">{{ prep_report.company_name }}</span>
              </div>
              {% endif %}
              {% if prep_report.created_at %}
              <div class="tldr-meta-row">
                <span class="tldr-k">Generated</span>
                <span class="tldr-v">{{ prep_report.created_at.strftime("%Y-%m-%d") }}</span>
              </div>
              {% endif %}
            </div>
          </div>

          <div class="tldr-grid">
            <a class="tldr-pill" href="#sec-know">
              <span class="tldr-emoji">üåç</span>
              <span class="tldr-label">Know their world</span>
              <span class="tldr-count">{{ know_count }}</span>
            </a>

            <a class="tldr-pill" href="#sec-fit">
              <span class="tldr-emoji">üß©</span>
              <span class="tldr-label">Perfect fit map</span>
              <span class="tldr-count">{{ fit_count }}</span>
            </a>

            <a class="tldr-pill" href="#sec-beh">
              <span class="tldr-emoji">üé§</span>
              <span class="tldr-label">Behavioral practice</span>
              <span class="tldr-count">{{ beh_count }}</span>
            </a>

            <a class="tldr-pill" href="#sec-tech">
              <span class="tldr-emoji">üõ†</span>
              <span class="tldr-label">Technical prep</span>
              <span class="tldr-count">{{ tech_count }}</span>
            </a>

            <a class="tldr-pill" href="#sec-up">
              <span class="tldr-emoji">üöÄ</span>
              <span class="tldr-label">Upgrade zone</span>
              <span class="tldr-count">{{ imp_count }}</span>
            </a>

            <a class="tldr-pill" href="#sec-ask">
              <span class="tldr-emoji">üí¨</span>
              <span class="tldr-label">Questions to ask</span>
              <span class="tldr-count">{{ ask_count }}</span>
            </a>
          </div>

          <div class="tldr-tip">
            Tip: skim the TLDR, then go section by section and rewrite your stories to match the company language.
          </div>
        </section>

        <div class="prep-layout">
          <aside class="prep-rail">
            <div class="rail-card">
              <div class="rail-title">Progress</div>
              <nav class="rail-nav">
                <a class="rail-link rail-know" href="#sec-know"><span class="rail-dot"></span><span class="rail-text">üåç Know their world</span></a>
                <a class="rail-link rail-fit" href="#sec-fit"><span class="rail-dot"></span><span class="rail-text">üß© Perfect fit map</span></a>
                <a class="rail-link rail-beh" href="#sec-beh"><span class="rail-dot"></span><span class="rail-text">üé§ Behavioral practice</span></a>
                <a class="rail-link rail-tech" href="#sec-tech"><span class="rail-dot"></span><span class="rail-text">üõ† Technical prep</span></a>
                <a class="rail-link rail-up" href="#sec-up"><span class="rail-dot"></span><span class="rail-text">üöÄ Upgrade zone</span></a>
                <a class="rail-link rail-ask" href="#sec-ask"><span class="rail-dot"></span><span class="rail-text">üí¨ Smart questions</span></a>
              </nav>

              <div class="rail-mini">
                <div class="rail-mini-row"><span>Items</span><strong>{{ know_count + fit_count + beh_count + tech_count + imp_count + ask_count }}</strong></div>
                <div class="rail-mini-row"><span>Mode</span><strong>{% if report.mode == "role_and_company" %}Role and company{% else %}Role focused{% endif %}</strong></div>
              </div>
            </div>
          </aside>

          <div class="prep-content">
            {% if know.mission_values or know.culture_snapshot or know.recent_projects_news or know.competitors_industry_trends %}
              <section class="report-section section-know" id="sec-know">
                <div class="section-head">
                  <h3 class="report-heading">üåç Know their world</h3>
                  <div class="section-chip">{{ know_count }} items</div>
                </div>
                <p class="section-intro">Learn the company language so your answers sound like someone who already belongs there.</p>

                {% if know.mission_values %}
                  <h4 class="report-subheading">Mission and values</h4>
                  {% for item in know.mission_values %}<p class="report-paragraph">‚Ä¢ {{ item }}</p>{% endfor %}
                {% endif %}

                {% if know.culture_snapshot %}
                  <h4 class="report-subheading">Culture snapshot</h4>
                  {% for item in know.culture_snapshot %}<p class="report-paragraph">‚Ä¢ {{ item }}</p>{% endfor %}
                {% endif %}

                {% if know.recent_projects_news %}
                  <h4 class="report-subheading">Recent projects and news</h4>
                  {% for item in know.recent_projects_news %}<p class="report-paragraph">‚Ä¢ {{ item }}</p>{% endfor %}
                {% endif %}

                {% if know.competitors_industry_trends %}
                  <h4 class="report-subheading">Competitors and industry trends</h4>
                  {% for item in know.competitors_industry_trends %}<p class="report-paragraph">‚Ä¢ {{ item }}</p>{% endfor %}
                {% endif %}
              </section>
            {% endif %}

            {% if fit.top_strengths or fit.best_projects %}
              <section class="report-section section-fit" id="sec-fit">
                <div class="section-head">
                  <h3 class="report-heading">üß© Your perfect fit map</h3>
                  <div class="section-chip">{{ fit_count }} items</div>
                </div>
                <p class="section-intro">Connect your background to what they care about so the interviewer can say yes faster.</p>

                {% if fit.top_strengths %}
                  <h4 class="report-subheading">Strengths to lean into</h4>
                  {% for s in fit.top_strengths %}<p class="report-paragraph">‚Ä¢ {{ s }}</p>{% endfor %}
                {% endif %}

                {% if fit.best_projects %}
                  <h4 class="report-subheading">Projects to spotlight</h4>
                  {% for proj in fit.best_projects %}
                    <p class="report-paragraph"><strong>{{ proj.title }}</strong>{% if proj.summary %} - {{ proj.summary }}{% endif %}</p>
                  {% endfor %}
                {% endif %}
              </section>
            {% endif %}

            {% if beh.questions or beh.example_answers %}
              <section class="report-section section-beh" id="sec-beh">
                <div class="section-head">
                  <h3 class="report-heading">üé§ Behavioral interview practice</h3>
                  <div class="section-chip">{{ beh_count }} items</div>
                </div>
                <p class="section-intro">Prepare structured stories that show ownership, impact, and clear decision making.</p>

                {% if beh.questions %}
                  <h4 class="report-subheading">Questions to prepare for</h4>
                  {% for q in beh.questions %}<p class="report-paragraph">‚Ä¢ {{ q }}</p>{% endfor %}
                {% endif %}

                {% if beh.example_answers %}
                  <h4 class="report-subheading">Sample STAR answers</h4>
                  {% for ex in beh.example_answers %}
                    <div class="report-example-block">
                      <p class="report-example-question">{{ ex.question }}</p>

                      {% if ex.experience_name %}
                        <p class="report-example-meta">
                          Experience: <strong>{{ ex.experience_name }}</strong>
                          {% if ex.confidence %}<span class="muted"> ({{ ex.confidence }})</span>{% endif %}
                        </p>
                      {% endif %}
                      {% if ex.experience_source_quote %}
                        <p class="report-example-meta muted">From resume: "{{ ex.experience_source_quote }}"</p>
                      {% endif %}

                      <p class="report-example-answer">{{ ex.answer }}</p>

                      {% if ex.legend %}
                        <p class="report-legend">
                          Legend:
                          {% for key, val in ex.legend.items() %}<span>{{ key }} {{ val }}</span>{% endfor %}
                        </p>
                      {% endif %}
                    </div>
                  {% endfor %}
                {% endif %}
              </section>
            {% endif %}

            {% if tech.questions or tech.example_answers or tech.key_concepts or tech.red_flags %}
              <section class="report-section section-tech" id="sec-tech">
                <div class="section-head">
                  <h3 class="report-heading">üõ† Technical or role specific preparation</h3>
                  <div class="section-chip">{{ tech_count }} items</div>
                </div>
                <p class="section-intro">Turn prep time into signal. Focus on the concepts and questions that are most likely to appear.</p>

                {% if tech.questions %}
                  <h4 class="report-subheading">Questions they may ask you</h4>
                  {% for q in tech.questions %}<p class="report-paragraph">‚Ä¢ {{ q }}</p>{% endfor %}
                {% endif %}

                {% if tech.example_answers %}
                  <h4 class="report-subheading">Sample technical answers</h4>
                  {% for ex in tech.example_answers %}
                    <div class="report-example-block">
                      <p class="report-example-question">{{ ex.question }}</p>

                      {% if ex.experience_name %}
                        <p class="report-example-meta">
                          Experience: <strong>{{ ex.experience_name }}</strong>
                          {% if ex.confidence %}<span class="muted"> ({{ ex.confidence }})</span>{% endif %}
                        </p>
                      {% endif %}
                      {% if ex.experience_source_quote %}
                        <p class="report-example-meta muted">From resume: "{{ ex.experience_source_quote }}"</p>
                      {% endif %}

                      <p class="report-example-answer">{{ ex.answer }}</p>

                      {% if ex.legend %}
                        <p class="report-legend">
                          Legend:
                          {% for key, val in ex.legend.items() %}<span>{{ key }} {{ val }}</span>{% endfor %}
                        </p>
                      {% endif %}
                    </div>
                  {% endfor %}
                {% endif %}

                {% if tech.key_concepts %}
                  <h4 class="report-subheading">Key concepts to review</h4>
                  {% for item in tech.key_concepts %}<p class="report-paragraph">‚Ä¢ {{ item }}</p>{% endfor %}
                {% endif %}

                {% if tech.red_flags %}
                  <h4 class="report-subheading">Common red flags to avoid</h4>
                  {% for item in tech.red_flags %}<p class="report-paragraph">‚Ä¢ {{ item }}</p>{% endfor %}
                {% endif %}
              </section>
            {% endif %}

          </div>
        </div>
      </div>
    </section>
  </main>

  <footer class="landing-footer">
    <p>¬© {{ current_year or "2025" }} NextStep.AI. All rights reserved.</p>
  </footer>
</body>
</html>
