<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>NextStep.AI - Mock Interview</title>

  <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/mock_interview.css') }}">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
        rel="stylesheet">
</head>

<body class="landing-body">
  {% include "navbar.html" %}

  <main class="mock-main">
    <div class="mock-shell">

      <!-- LEFT: AI INTERVIEWER -->
      <section class="panel ai-panel">
        <header class="panel-header">
          <div class="name-badge">
            <span class="status-dot status-online"></span>
            <span class="name-label">AI Interviewer</span>
          </div>
          <span class="role-label">Behavioral Coach</span>
        </header>

        <!-- Interview setup -->
        <div class="mock-config">
          <div class="mock-config-row">
            <div class="mock-config-field">
              <label for="mock-role-input" class="mock-config-label">Position / role</label>
              <input
                id="mock-role-input"
                type="text"
                class="mock-config-input"
                placeholder="Software Engineer, Product Manager..."
              >
            </div>
            <div class="mock-config-field">
              <label for="mock-company-input" class="mock-config-label">Company (optional)</label>
              <input
                id="mock-company-input"
                type="text"
                class="mock-config-input"
                placeholder="Amazon, Google, Meta..."
              >
            </div>
          </div>
          <p class="mock-config-hint">
            Fabio will tailor the interview to this role and company for a 10 question session.
          </p>
        </div>

        <div class="avatar-zone">
          <div class="avatar-glow">
            <div class="avatar-ring">
              <img
                id="ai-avatar"
                class="avatar-img"
                src="{{ url_for('static', filename='img/avatar/avatar_neutral.png') }}"
                data-neutral-src="{{ url_for('static', filename='img/avatar/avatar_neutral.png') }}"
                data-blink-src="{{ url_for('static', filename='img/avatar/avatar_blink.png') }}"
                data-mouth-closed-src="{{ url_for('static', filename='img/avatar/avatar_mouth_closed.png') }}"
                data-mouth-half-src="{{ url_for('static', filename='img/avatar/avatar_mouth_half.png') }}"
                data-mouth-open-src="{{ url_for('static', filename='img/avatar/avatar_mouth_open.png') }}"
                data-listen-src="{{ url_for('static', filename='img/avatar/avatar_listen.png') }}"
                data-think-src="{{ url_for('static', filename='img/avatar/avatar_think.png') }}"
                alt="AI Interviewer"
              />
            </div>
          </div>
        </div>

        <div class="ai-speech">
          <p id="ai-text">
            Tell Fabio what role you are preparing for and press "Start interview" to begin your live mock interview.
          </p>
        </div>

        <div class="ai-controls">
          <button id="start-interview-btn" class="primary-btn">
            Start tailored mock interview
          </button>
          <button id="repeat-question-btn" class="ghost-btn" disabled>
            Repeat question
          </button>
        </div>

        <audio id="ai-audio"></audio>
      </section>

      <!-- RIGHT: CANDIDATE -->
      <section class="panel user-panel"
               data-username="{{ current_user.username if current_user else 'Candidate' }}">
        <header class="panel-header">
          <div class="name-badge">
            <span class="status-dot" id="camera-status-dot"></span>
            <span class="name-label" id="candidate-name">
              {{ current_user.username if current_user else "Candidate" }}
            </span>
          </div>
          <span class="role-label">You</span>
        </header>

        <div class="user-video-zone">
          <video id="user-video" class="user-video" autoplay muted playsinline></video>

          <div id="user-placeholder" class="user-placeholder">
            <div class="user-initials">
              {{ (current_user.username[0]|upper) if current_user and current_user.username else "Y" }}
            </div>
            <p class="user-placeholder-text">
              Camera is off or blocked.
            </p>
            <p class="user-placeholder-sub">
              You can still practice. Your answers will be recorded by audio or text.
            </p>
          </div>
        </div>

        <div class="answer-controls">
          <div class="answer-mode-toggle">
            <button
              class="answer-mode-btn answer-mode-btn-active"
              data-mode="voice"
              type="button"
            >
              Voice answer
            </button>
            <button
              class="answer-mode-btn"
              data-mode="text"
              type="button"
            >
              Type answer
            </button>
          </div>

          <p class="answer-label">Your answer</p>

          <!-- Voice controls -->
          <div id="voice-answer-controls">
            <div class="answer-buttons">
              <button id="start-record-btn" class="primary-btn">
                Start recording answer
              </button>
              <button id="stop-record-btn" class="danger-btn" disabled>
                Stop
              </button>
            </div>
            <div class="recording-status" id="recording-status">
              <span class="recording-dot" id="recording-dot"></span>
              <span id="recording-text">Not recording</span>
            </div>
          </div>

          <!-- Text controls -->
          <div id="text-answer-controls" class="hidden">
            <textarea
              id="text-answer-input"
              class="text-answer-input"
              rows="4"
              placeholder="Type your answer here if you prefer not to record your voice..."
            ></textarea>
            <div class="answer-buttons" style="margin-top: 0.5rem;">
              <button id="submit-text-answer-btn" class="primary-btn" type="button">
                Submit text answer
              </button>
            </div>
            <div class="recording-status">
              <span class="recording-dot"></span>
              <span id="text-answer-status">Ready for your typed answer</span>
            </div>
          </div>
        </div>

        <div class="answer-log">
          <p class="answer-log-title">Live feedback report</p>
          <p class="answer-log-body" id="answer-log-body">
            As you answer, your transcript and feedback for each question will appear here in real time.
          </p>
        </div>

      </section>
    </div>
  </main>

  <script src="{{ url_for('static', filename='js/mock_interview.js') }}"></script>
</body>
</html>
