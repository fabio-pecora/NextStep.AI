<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Resume review - {{ resume_report.target_role or report.target_role or "Resume" }}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/saved_prep_report.css') }}">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body class="prep-view-body">
  {% include "navbar.html" %}

  <main class="prep-view-main">
    <div class="prep-view-header-row">
      <div>
        <h1 class="prep-title">
          Resume review
          {% if resume_report.target_role or report.target_role %}
            <span class="muted"> · {{ resume_report.target_role or report.target_role }}</span>
          {% endif %}
        </h1>
        <p class="prep-subtitle">
          A focused resume feedback report with rewrites, structure advice, and keyword tips
          tailored to your profile{% if resume_report.target_role or report.target_role %} and the role
          <strong>{{ resume_report.target_role or report.target_role }}</strong>{% endif %}.
          {% if resume_report.created_at %}
            <span class="gen-date">Generated on {{ resume_report.created_at.strftime("%Y-%m-%d") }}</span>
          {% endif %}
        </p>
      </div>

      <div class="prep-view-actions">
        <a class="btn btn-outline prep-back-link" href="{{ url_for('profile') }}">Back to profile</a>
        <a class="btn btn-primary" href="{{ url_for('download_saved_resume_report_pdf', report_id=resume_report.id) }}">
          Download as PDF
        </a>
      </div>
    </div>

    <section class="report-page">
      <header class="report-topbar">
        <div>
          <div class="brand">NextStep.<span>AI</span></div>
          <p class="topbar-subtitle">Resume review report</p>
        </div>
        <div class="meta">
          <div class="title">
            Resume review
            {% if resume_report.target_role or report.target_role %}
              · <strong>{{ resume_report.target_role or report.target_role }}</strong>
            {% endif %}
          </div>
          {% if resume_report.created_at %}
            <div class="stamp">
              Generated on {{ resume_report.created_at.strftime("%Y-%m-%d") }}
            </div>
          {% endif %}
        </div>
      </header>

      <section class="report-card">
        <div class="report-badges">
          <span class="tag">AI generated</span>
          <span class="tag">Resume feedback</span>
          {% if report.keywords.target_role %}
            <span class="tag">Target: {{ report.keywords.target_role }}</span>
          {% endif %}
          {% if report.spacing_readability.scannability_score %}
            <span class="tag warning">
              Scannability {{ report.spacing_readability.scannability_score }}/10
            </span>
          {% endif %}
        </div>

        <div class="report-content">
          {# 1. SUMMARY AT A GLANCE #}
          <section class="resume-section">
            <div class="resume-section-header">
              <span class="section-index">1</span>
              <div>
                <h2>Summary at a glance</h2>
                <p>High level view of how strong this resume is for your target role.</p>
              </div>
            </div>

            <div class="resume-summary-grid">
              <div class="resume-summary-main">
                <p>{{ report.summary }}</p>
              </div>
              <aside class="resume-score-card">
                {% set score = report.spacing_readability.scannability_score or 7 %}
                <div class="score-circle" style="--score: {{ score }}">
                  <span class="score-number">{{ score }}</span>
                  <span class="score-label">Scannability</span>
                </div>
                {% if report.spacing_readability.tips %}
                  <ul class="score-tips">
                    {% for tip in report.spacing_readability.tips %}
                      <li>{{ tip }}</li>
                    {% endfor %}
                  </ul>
                {% endif %}
              </aside>
            </div>
          </section>

          {# 2. SECTIONS AND STRUCTURE #}
          <section class="resume-section">
            <div class="resume-section-header">
              <span class="section-index">2</span>
              <div>
                <h2>Sections and structure</h2>
                <p>What is working and what needs a fix in each major section.</p>
              </div>
            </div>

            <div class="resume-two-col">
              <div>
                <p class="resume-col-title">Overall structure</p>
                <div class="badge-row">
                  {% for s in report.sections.overall_structure.strengths or [] %}
                    <div class="badge strength">✓ {{ s }}</div>
                  {% endfor %}
                  {% for issue in report.sections.overall_structure.issues or [] %}
                    <div class="badge issue">✗ {{ issue }}</div>
                  {% endfor %}
                  {% for rec in report.sections.overall_structure.recommendations or [] %}
                    <div class="badge recommendation">→ {{ rec }}</div>
                  {% endfor %}
                </div>

                <p class="resume-col-title" style="margin-top:0.9rem;">Experience</p>
                <div class="badge-row">
                  {% for s in report.sections.experience.strengths or [] %}
                    <div class="badge strength">✓ {{ s }}</div>
                  {% endfor %}
                  {% for issue in report.sections.experience.issues or [] %}
                    <div class="badge issue">✗ {{ issue }}</div>
                  {% endfor %}
                  {% for rec in report.sections.experience.recommendations or [] %}
                    <div class="badge recommendation">→ {{ rec }}</div>
                  {% endfor %}
                </div>
              </div>

              <div>
                <p class="resume-col-title">Education</p>
                <div class="badge-row">
                  {% for s in report.sections.education.strengths or [] %}
                    <div class="badge strength">✓ {{ s }}</div>
                  {% endfor %}
                  {% for issue in report.sections.education.issues or [] %}
                    <div class="badge issue">✗ {{ issue }}</div>
                  {% endfor %}
                  {% for rec in report.sections.education.recommendations or [] %}
                    <div class="badge recommendation">→ {{ rec }}</div>
                  {% endfor %}
                </div>

                <p class="resume-col-title" style="margin-top:0.9rem;">Skills</p>
                <div class="badge-row">
                  {% for s in report.sections.skills.strengths or [] %}
                    <div class="badge strength">✓ {{ s }}</div>
                  {% endfor %}
                  {% for issue in report.sections.skills.issues or [] %}
                    <div class="badge issue">✗ {{ issue }}</div>
                  {% endfor %}
                  {% for rec in report.sections.skills.recommendations or [] %}
                    <div class="badge recommendation">→ {{ rec }}</div>
                  {% endfor %}
                </div>
              </div>
            </div>
          </section>

          {# 3. EXPERIENCE BULLET UPGRADES #}
          <section class="resume-section">
            <div class="resume-section-header">
              <span class="section-index">3</span>
              <div>
                <h2>Experience bullet upgrades</h2>
                <p>Side by side rewrites that show impact, metrics, and clarity.</p>
              </div>
            </div>

            {% if report.experience_bullets.rewrites %}
              {% for rw in report.experience_bullets.rewrites %}
                <div class="bullet-grid" style="margin-bottom:0.9rem;">
                  <article class="bullet-card">
                    <div class="bullet-label">Original</div>
                    <p class="bullet-text">{{ rw.original }}</p>
                  </article>
                  <article class="bullet-card">
                    <div class="bullet-label">Improved</div>
                    <p class="bullet-text"><strong>{{ rw.improved }}</strong></p>
                    {% if rw.why_it_is_better %}
                      <p class="bullet-why">{{ rw.why_it_is_better }}</p>
                    {% endif %}
                  </article>
                </div>
              {% endfor %}
            {% endif %}

            {% if report.experience_bullets.title_suggestions %}
              <h4 class="report-subheading" style="margin-top:0.6rem;">Title suggestions</h4>
              <div class="title-pill-row">
                {% for t in report.experience_bullets.title_suggestions %}
                  <div class="title-pill">
                    {{ t.original_title }} → {{ t.suggested_title }}
                  </div>
                {% endfor %}
              </div>
            {% endif %}

            {% if report.experience_bullets.missing_information %}
              <h4 class="report-subheading" style="margin-top:0.7rem;">Missing information</h4>
              <ul>
                {% for item in report.experience_bullets.missing_information %}
                  <li>{{ item }}</li>
                {% endfor %}
              </ul>
            {% endif %}
          </section>

          {# 4. STRUCTURE RECOMMENDATIONS #}
          <section class="resume-section">
            <div class="resume-section-header">
              <span class="section-index">4</span>
              <div>
                <h2>Structure recommendations</h2>
                <p>How to order sections so your best story appears first.</p>
              </div>
            </div>

            {% if report.structure.ordering %}
              <h4 class="report-subheading">Recommended ordering</h4>
              <ul>
                {% for line in report.structure.ordering %}
                  <li>{{ line }}</li>
                {% endfor %}
              </ul>
            {% endif %}

            {% set s_add = report.structure.sections_to_add_or_remove.add or [] %}
            {% set s_remove = report.structure.sections_to_add_or_remove.remove or [] %}

            {% if s_add or s_remove %}
              <div class="resume-two-col" style="margin-top:0.8rem;">
                <div>
                  <p class="resume-col-title">Add</p>
                  <div class="badge-row">
                    {% for item in s_add %}
                      <div class="badge recommendation">+ {{ item }}</div>
                    {% endfor %}
                  </div>
                </div>
                <div>
                  <p class="resume-col-title">Remove</p>
                  <div class="badge-row">
                    {% for item in s_remove %}
                      <div class="badge issue">- {{ item }}</div>
                    {% endfor %}
                  </div>
                </div>
              </div>
            {% endif %}
          </section>

          {# 5. KEYWORDS AND FINAL TWEAKS #}
          <section class="resume-section">
            <div class="resume-section-header">
              <span class="section-index">5</span>
              <div>
                <h2>Keywords and final polish</h2>
                <p>Make sure applicant tracking systems and recruiters see the right words.</p>
              </div>
            </div>

            <p class="resume-col-title">Target role</p>
            <p class="report-paragraph">
              {{ report.keywords.target_role or resume_report.target_role or "Not specified" }}
            </p>

            <div class="keywords-layout" style="margin-top:0.7rem;">
              <div>
                <h4>Missing keywords</h4>
                {% for kw in report.keywords.missing_keywords or [] %}
                  <div class="badge keyword-missing">⚠ {{ kw }}</div>
                {% endfor %}

                <h4 style="margin-top:0.7rem;">How to add them</h4>
                {% for how in report.keywords.how_to_add_them or [] %}
                  <div class="badge recommendation">→ {{ how }}</div>
                {% endfor %}
              </div>

              <div>
                <h4>Strong keywords already present</h4>
                {% for kw in report.keywords.present_keywords_to_keep or [] %}
                  <div class="badge keyword-present">✔ {{ kw }}</div>
                {% endfor %}
              </div>
            </div>
          </section>
        </div>
      </section>
    </section>
  </main>

  <footer class="landing-footer">
    <p>© {{ current_year or "2025" }} NextStep.AI. All rights reserved.</p>
  </footer>
</body>
</html>
