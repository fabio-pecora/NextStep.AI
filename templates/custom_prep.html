<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>NextStep.AI - Custom AI prep</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/custom_prep.css') }}">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body class="landing-body">
  {% include "navbar.html" %}
  <main>
    <section class="custom-page-section">
      <div class="app-shell custom-shell">

        <!-- Top banner -->
        <div class="card custom-banner no-print">
          <div class="custom-banner-main">
            <h1>Custom AI prep report</h1>
            <p class="subtitle">
              Fill in the role, company, description, and upload your resume. NextStep.AI turns it into a focused interview guide with questions, tips, and clear next steps.
            </p>
          </div>
          <div class="custom-banner-steps">
            <div class="custom-step">
              <div class="step-circle">1</div>
              <div class="step-info">
                <h4>Describe the role</h4>
                <p>Job title and company</p>
              </div>
            </div>
            <div class="custom-step">
              <div class="step-circle">2</div>
              <div class="step-info">
                <h4>Add context</h4>
                <p>Job description and resume</p>
              </div>
            </div>
            <div class="custom-step">
              <div class="step-circle">3</div>
              <div class="step-info">
                <h4>Review the plan</h4>
                <p>Questions, tips, next steps</p>
              </div>
            </div>
          </div>
        </div>

        <!-- What you will see in the report -->
        <section class="card report-preview-section no-print" aria-labelledby="report-preview-title">
          <div class="report-preview-head">
            <div class="sparkle-orb" aria-hidden="true"></div>
            <h2 id="report-preview-title">What you will see in the report</h2>
            <p class="subtitle">
              A guided, company aware plan built from your job description and resume.
            </p>
          </div>

          <div class="report-feature-grid">
            <!-- 1 Company values and mission -->
            <article class="feature-card">
              <div class="feature-icon" aria-hidden="true">
                <svg viewBox="0 0 24 24" width="24" height="24" fill="none" role="img">
                  <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="1.5"/>
                  <circle cx="12" cy="12" r="4.5" stroke="currentColor" stroke-width="1.5"/>
                  <path d="M12 3v3M21 12h-3M12 21v-3M6 12H3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
              </div>
              <div class="feature-text">
                <h3>Company match</h3>
                <p>Insights aligned to mission, values, and culture.</p>
              </div>
            </article>

            <!-- 2 Recent news -->
            <article class="feature-card">
              <div class="feature-icon" aria-hidden="true">
                <svg viewBox="0 0 24 24" width="24" height="24" fill="none" role="img">
                  <rect x="3" y="5" width="14" height="14" rx="2" stroke="currentColor" stroke-width="1.5"/>
                  <path d="M7 8h6M7 11h6M7 14h3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                  <path d="M17 7h2a2 2 0 0 1 2 2v6a4 4 0 0 1-4 4h-2" stroke="currentColor" stroke-width="1.5"/>
                </svg>
              </div>
              <div class="feature-text">
                <h3>Latest moves</h3>
                <p>Recent projects and news to reference in conversation.</p>
              </div>
            </article>

            <!-- 3 Behavioral questions -->
            <article class="feature-card">
              <div class="feature-icon" aria-hidden="true">
                <svg viewBox="0 0 24 24" width="24" height="24" fill="none" role="img">
                  <path d="M7 15H6a4 4 0 0 1-4-4V8a4 4 0 0 1 4-4h8a4 4 0 0 1 4 4v1" stroke="currentColor" stroke-width="1.5"/>
                  <path d="M10 17h5l3 3v-3h0a4 4 0 0 0 4-4v-2a4 4 0 0 0-4-4h-1" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
              </div>
              <div class="feature-text">
                <h3>Behavioral deep search</h3>
                <p>Company specific behavioral questions and STAR prompts.</p>
              </div>
            </article>

            <!-- 4 Technical questions -->
            <article class="feature-card">
              <div class="feature-icon" aria-hidden="true">
                <svg viewBox="0 0 24 24" width="24" height="24" fill="none" role="img">
                  <rect x="7" y="7" width="10" height="10" rx="2" stroke="currentColor" stroke-width="1.5"/>
                  <path d="M12 2v3M12 19v3M2 12h3M19 12h3M5 5l2 2M17 17l2 2M17 5l2 2M5 17l2 2" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
              </div>
              <div class="feature-text">
                <h3>Technical focus</h3>
                <p>Role specific questions and example answers.</p>
              </div>
            </article>

            <!-- 5 Use your resume in answers -->
            <article class="feature-card">
              <div class="feature-icon" aria-hidden="true">
                <svg viewBox="0 0 24 24" width="24" height="24" fill="none" role="img">
                  <path d="M14 3H7a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V8z" stroke="currentColor" stroke-width="1.5"/>
                  <path d="M14 3v5h5" stroke="currentColor" stroke-width="1.5"/>
                  <path d="M9 14l2 2 4-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
              </div>
              <div class="feature-text">
                <h3>Resume powered</h3>
                <p>We craft examples using your actual experience.</p>
              </div>
            </article>

            <!-- 6 What makes you stand out -->
            <article class="feature-card">
              <div class="feature-icon" aria-hidden="true">
                <svg viewBox="0 0 24 24" width="24" height="24" fill="none" role="img">
                  <path d="M12 3l2.6 5.3 5.9.9-4.2 4.1 1 5.8L12 16.9 6.7 19l1-5.8-4.2-4.1 5.9-.9z" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/>
                </svg>
              </div>
              <div class="feature-text">
                <h3>Standout signals</h3>
                <p>Specific strengths that match the position.</p>
              </div>
            </article>

            <!-- 7 Study material -->
            <article class="feature-card">
              <div class="feature-icon" aria-hidden="true">
                <svg viewBox="0 0 24 24" width="24" height="24" fill="none" role="img">
                  <path d="M3 6.5A3.5 3.5 0 0 1 6.5 3H12v16H6.5A3.5 3.5 0 0 0 3 22z" stroke="currentColor" stroke-width="1.5"/>
                  <path d="M21 6.5A3.5 3.5 0 0 0 17.5 3H12v16h5.5A3.5 3.5 0 0 1 21 22z" stroke="currentColor" stroke-width="1.5"/>
                </svg>
              </div>
              <div class="feature-text">
                <h3>Targeted study</h3>
                <p>Short list of topics and resources to review.</p>
              </div>
            </article>

            <!-- 8 Smart follow ups -->
            <article class="feature-card">
              <div class="feature-icon" aria-hidden="true">
                <svg viewBox="0 0 24 24" width="24" height="24" fill="none" role="img">
                  <path d="M9.5 8a3.5 3.5 0 1 1 3.7 3.5c-.8.1-1.2.7-1.2 1.5v.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                  <circle cx="12" cy="18" r="1" fill="currentColor"/>
                </svg>
              </div>
              <div class="feature-text">
                <h3>Follow up questions</h3>
                <p>Ask with confidence and show real interest.</p>
              </div>
            </article>
          </div>
        </section>

        <div class="custom-layout">
          <!-- Left: form -->
          <section class="card custom-form-card no-print">
            <h2 class="section-title">Tell us about the interview</h2>
            <p class="subtitle">
              All fields below are required so the AI can build a precise, tailored prep plan for you.
            </p>

            {% if error %}
              <p class="error">{{ error }}</p>
            {% endif %}

            {% if report and report.error %}
              <p class="error">{{ report.error }}</p>
            {% endif %}

            <form method="POST" enctype="multipart/form-data" class="custom-form" id="custom-prep-form">
              <!-- Job position (required) -->
              <div class="field">
                <label for="job_title">Job position <span class="required-dot">*</span></label><br>
                <input
                  type="text"
                  id="job_title"
                  name="job_title"
                  placeholder="Software Engineer Intern, Data Analyst..."
                  required
                >
              </div>

              <!-- Company name (required) -->
              <div class="field">
                <label for="company_name">Company name <span class="required-dot">*</span></label><br>
                <input
                  type="text"
                  id="company_name"
                  name="company_name"
                  placeholder="Google, Amazon, Spotify..."
                  required
                >
              </div>

              <!-- Job description (required) -->
              <div class="field">
                <label for="job_description">Job description <span class="required-dot">*</span></label><br>
                <textarea
                  id="job_description"
                  name="job_description"
                  placeholder="Paste the job description here. The AI will pick themes, responsibilities, and required skills."
                  required
                ></textarea>
              </div>

              <!-- Resume PDF (required) -->
              <div class="field">
                <label for="resume_file">Your resume (PDF) <span class="required-dot">*</span></label><br>

                <div class="resume-upload-wrapper">
                  <div class="resume-dropzone" id="resume-dropzone">
                    <input
                      type="file"
                      id="resume_file"
                      name="resume_file"
                      accept="application/pdf"
                      class="resume-file-input"
                      required
                    >
                    <div class="resume-dropzone-inner">
                      <div class="resume-icon">
                        <svg viewBox="0 0 24 24" width="28" height="28" fill="none" aria-hidden="true">
                          <path d="M7 3h7l5 5v13H7a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z" stroke="currentColor" stroke-width="1.4" />
                          <path d="M14 3v5h5" stroke="currentColor" stroke-width="1.4" />
                          <path d="M9 13h6M9 16h4" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" />
                        </svg>
                      </div>
                      <p class="resume-title">Drop your PDF resume here</p>
                      <p class="resume-subtitle">or click to browse</p>
                      <p class="resume-file-name" id="resume-file-name">No file selected</p>
                    </div>
                  </div>
                  <p class="field-hint">
                    PDF files only. We will read the text and use it in your report.
                  </p>
                </div>
              </div>

              <!-- Optional skills / experiences text -->
              <div class="field">
                <label for="resume">
                  If you do not have a PDF, write your skills and experiences here (optional)
                </label><br>
                <textarea
                  id="resume"
                  name="resume"
                  placeholder="Share your key skills, projects, and experiences. We will use this if no resume text is available."
                >{% if current_user and current_user.resume_text %}{{ current_user.resume_text }}{% endif %}</textarea>
              </div>

              <div class="btn-row">
                <button type="submit" class="btn btn-primary">
                  Generate prep report
                </button>
              </div>

              <p class="custom-small-hint">
                You can iterate on the report. Update details here and regenerate if something changes.
              </p>
            </form>
          </section>

          <!-- Right: status / open popup -->
          <section class="card custom-report-card no-print">
            {% if report %}
              <div class="report-ready-panel">
                <h2>Your prep report is ready</h2>
                <p class="subtitle">
                  Open the report to view a clean, form style document with all your sections neatly divided. You can also download it as a PDF.
                </p>

                <div class="btn-row">
                  <button type="button" class="btn btn-primary" id="open-report-modal-btn">
                    Open report
                  </button>
                  <button type="button" class="btn btn-outline" onclick="downloadReportPDF()">
                    Download as PDF
                  </button>
                </div>

                <ul class="report-key-points">
                  <li>Company and role overview</li>
                  <li>Behavioral and technical questions with examples</li>
                  <li>Strengths, gaps, and clear next steps before the interview</li>
                </ul>
              </div>
            {% else %}
              <div class="custom-empty-report">
                <h2>Your prep report will appear here</h2>
                <p class="subtitle">
                  Fill the form on the left and NextStep.AI will build a tailored prep guide. You will see questions, tips, and clear next actions in this panel.
                </p>
              </div>
            {% endif %}
          </section>
        </div>
      </div>
    </section>
  </main>

  <footer class="landing-footer no-print">
    <p>© {{ current_year or "2025" }} NextStep.AI. All rights reserved.</p>
  </footer>

  <!-- Report popup -->
  {% if report %}
    <div id="report-modal" class="report-modal-backdrop">
      <div class="report-modal-inner" id="report-modal-inner">
        <button
          type="button"
          class="report-modal-close no-print"
          id="close-report-modal-btn"
        >
          Back to profile
        </button>

        <header class="report-header">
          <div class="report-logo-mark">
            <div class="report-logo-text">NextStep.<span>AI</span></div>
            <div class="report-logo-tagline">Interview preparation report</div>
          </div>

          <div class="report-meta">
            <p class="report-job">
              {{ report.job_title }}
              {% if report.company_name %} · {{ report.company_name }}{% endif %}
            </p>
            {% if report.candidate_name %}
              <p class="report-candidate">Prepared for {{ report.candidate_name }}</p>
            {% endif %}
            <div class="report-tags no-print">
              <span class="report-tag">AI generated</span>
              {% if report.company_name %}
                <span class="report-tag">Company specific</span>
              {% endif %}
              <span class="report-tag">
                {% if report.mode == "role_and_company" %}
                  Role and company insights
                {% else %}
                  Role focused prep
                {% endif %}
              </span>
              {% if report.debug_note %}
                <span class="report-tag report-tag-warning">Fallback mode</span>
              {% endif %}
            </div>
            <button type="button" class="btn btn-outline report-download-btn no-print" onclick="downloadReportPDF()">
              Download as PDF
            </button>
          </div>
        </header>

        <div class="report-modal-body" id="report-content">
          {% if report.debug_note %}
            <p class="report-debug-note no-print">{{ report.debug_note }}</p>
          {% endif %}

          {% set know = report.know_all_about_them or {} %}
          {% if know.mission_values or know.culture_snapshot or know.recent_projects_news or know.competitors_industry_trends %}
            <section class="report-section">
              <h3 class="report-heading">1. Know their world</h3>
              {% if know.mission_values %}
                <h4 class="report-subheading">Mission and values</h4>
                {% for item in know.mission_values %}
                  <p class="report-paragraph">• {{ item }}</p>
                {% endfor %}
              {% endif %}
              {% if know.culture_snapshot %}
                <h4 class="report-subheading">Culture snapshot</h4>
                {% for item in know.culture_snapshot %}
                  <p class="report-paragraph">• {{ item }}</p>
                {% endfor %}
              {% endif %}
              {% if know.recent_projects_news %}
                <h4 class="report-subheading">Recent projects and news</h4>
                {% for item in know.recent_projects_news %}
                  <p class="report-paragraph">• {{ item }}</p>
                {% endfor %}
              {% endif %}
              {% if know.competitors_industry_trends %}
                <h4 class="report-subheading">Competitors and industry trends</h4>
                {% for item in know.competitors_industry_trends %}
                  <p class="report-paragraph">• {{ item }}</p>
                {% endfor %}
              {% endif %}
            </section>
          {% endif %}

          {% set fit = report.perfect_fit_map or {} %}
          {% if fit.top_strengths or fit.best_projects %}
            <section class="report-section">
              <h3 class="report-heading">2. Your perfect fit map</h3>
              {% if fit.top_strengths %}
                <h4 class="report-subheading">Strengths to lean into</h4>
                {% for s in fit.top_strengths %}
                  <p class="report-paragraph">• {{ s }}</p>
                {% endfor %}
              {% endif %}
              {% if fit.best_projects %}
                <h4 class="report-subheading">Projects to spotlight</h4>
                {% for proj in fit.best_projects %}
                  <p class="report-paragraph">
                    <strong>{{ proj.title }}</strong>{% if proj.summary %} - {{ proj.summary }}{% endif %}
                  </p>
                {% endfor %}
              {% endif %}
            </section>
          {% endif %}

          {% set beh = report.behavioral_practice or {} %}
          {% if beh.questions or beh.example_answers %}
            <section class="report-section">
              <h3 class="report-heading">3. Behavioral interview practice</h3>
              {% if beh.questions %}
                <h4 class="report-subheading">Questions to prepare for</h4>
                {% for q in beh.questions %}
                  <p class="report-paragraph">• {{ q }}</p>
                {% endfor %}
              {% endif %}
              {% if beh.example_answers %}
                <h4 class="report-subheading">Sample STAR answers</h4>
                {% for ex in beh.example_answers %}
                  <div class="report-example-block">
                    <p class="report-example-question">{{ ex.question }}</p>
                    <p class="report-example-answer">{{ ex.answer }}</p>
                    {% if ex.legend %}
                      <p class="report-legend">
                        Legend:
                        {% for key, val in ex.legend.items() %}
                          <span>{{ key }} {{ val }}</span>
                        {% endfor %}
                      </p>
                    {% endif %}
                  </div>
                {% endfor %}
              {% endif %}
            </section>
          {% endif %}

          {% set tech = report.technical_prep or {} %}
          {% if tech.questions or tech.example_answers or tech.key_concepts or tech.red_flags %}
            <section class="report-section">
              <h3 class="report-heading">4. Technical or role specific preparation</h3>
              {% if tech.questions %}
                <h4 class="report-subheading">Questions they may ask you</h4>
                {% for q in tech.questions %}
                  <p class="report-paragraph">• {{ q }}</p>
                {% endfor %}
              {% endif %}
              {% if tech.example_answers %}
                <h4 class="report-subheading">Example responses</h4>
                {% for ex in tech.example_answers %}
                  <div class="report-example-block">
                    <p class="report-example-question">{{ ex.question }}</p>
                    <p class="report-example-answer">{{ ex.answer }}</p>
                  </div>
                {% endfor %}
              {% endif %}
              {% if tech.key_concepts %}
                <h4 class="report-subheading">Key concepts to review</h4>
                {% for item in tech.key_concepts %}
                  <p class="report-paragraph">• {{ item }}</p>
                {% endfor %}
              {% endif %}
              {% if tech.red_flags %}
                <h4 class="report-subheading">Common red flags to avoid</h4>
                {% for item in tech.red_flags %}
                  <p class="report-paragraph">• {{ item }}</p>
                {% endfor %}
              {% endif %}
            </section>
          {% endif %}

          {% set imp = report.improvement_zone or {} %}
          {% if imp.skill_gaps or imp.soft_skills or imp.learning_focus %}
            <section class="report-section">
              <h3 class="report-heading">5. Upgrade yourself before the interview</h3>
              {% if imp.skill_gaps %}
                <h4 class="report-subheading">Skill gaps to work on</h4>
                {% for item in imp.skill_gaps %}
                  <p class="report-paragraph">• {{ item }}</p>
                {% endfor %}
              {% endif %}
              {% if imp.soft_skills %}
                <h4 class="report-subheading">Soft skills to sharpen</h4>
                {% for item in imp.soft_skills %}
                  <p class="report-paragraph">• {{ item }}</p>
                {% endfor %}
              {% endif %}
              {% if imp.learning_focus %}
                <h4 class="report-subheading">Focus for this week</h4>
                {% for item in imp.learning_focus %}
                  <p class="report-paragraph">• {{ item }}</p>
                {% endfor %}
              {% endif %}
            </section>
          {% endif %}

          {% set itm = report.impress_them_back or {} %}
          {% if itm.team_culture or itm.impact_growth or itm.technical_depth or itm.company_direction or itm.next_steps %}
            <section class="report-section">
              <h3 class="report-heading">6. Smart questions to ask them</h3>
              {% if itm.team_culture %}
                <h4 class="report-subheading">Team and culture</h4>
                {% for q in itm.team_culture %}
                  <p class="report-paragraph">• {{ q }}</p>
                {% endfor %}
              {% endif %}
              {% if itm.impact_growth %}
                <h4 class="report-subheading">Impact and growth</h4>
                {% for q in itm.impact_growth %}
                  <p class="report-paragraph">• {{ q }}</p>
                {% endfor %}
              {% endif %}
              {% if itm.technical_depth %}
                <h4 class="report-subheading">Technical depth</h4>
                {% for q in itm.technical_depth %}
                  <p class="report-paragraph">• {{ q }}</p>
                {% endfor %}
              {% endif %}
              {% if itm.company_direction %}
                <h4 class="report-subheading">Company direction</h4>
                {% for q in itm.company_direction %}
                  <p class="report-paragraph">• {{ q }}</p>
                {% endfor %}
              {% endif %}
              {% if itm.next_steps %}
                <h4 class="report-subheading">Next steps</h4>
                {% for q in itm.next_steps %}
                  <p class="report-paragraph">• {{ q }}</p>
                {% endfor %}
              {% endif %}
            </section>
          {% endif %}
        </div>
      </div>
    </div>
  {% endif %}

  <!-- Loading overlay -->
  <div id="report-loading" class="report-loading-overlay no-print">
    <div class="report-loading-inner">
      <div class="report-spinner"></div>
      <p>NextStep.AI is crafting your prep guide…</p>
    </div>
  </div>

  <script>
    
    function openReportModal() {
      const backdrop = document.getElementById('report-modal');
      if (!backdrop) return;
      backdrop.classList.add('is-visible');
      document.body.classList.add('report-modal-open');
    }

    function closeReportModal() {
      window.location.href = "{{ url_for('profile') }}";
    }

    function downloadReportPDF() {
      const backdrop = document.getElementById('report-modal');
      if (backdrop && !backdrop.classList.contains('is-visible')) {
        backdrop.classList.add('is-visible');
      }
      window.print();
    }

    document.addEventListener('DOMContentLoaded', function () {
      const form = document.getElementById('custom-prep-form');
      const overlay = document.getElementById('report-loading');
      const openBtn = document.getElementById('open-report-modal-btn');
      const closeBtn = document.getElementById('close-report-modal-btn');

      if (form && overlay) {
        form.addEventListener('submit', function () {
          overlay.style.display = 'flex';
        });
      }
      if (openBtn) openBtn.addEventListener('click', openReportModal);
      if (closeBtn) closeBtn.addEventListener('click', closeReportModal);

      if (document.getElementById('report-modal')) {
        openReportModal();
      }

      // Resume drag and drop box logic
      const dropzone = document.getElementById('resume-dropzone');
      const fileInput = document.getElementById('resume_file');
      const fileNameEl = document.getElementById('resume-file-name');

      if (dropzone && fileInput && fileNameEl) {
        // Click on box opens file dialog
        dropzone.addEventListener('click', function () {
          fileInput.click();
        });

        // File selected via dialog
        fileInput.addEventListener('change', function () {
          const file = fileInput.files[0];
          if (file) {
            fileNameEl.textContent = file.name;
            dropzone.classList.add('has-file');
          } else {
            fileNameEl.textContent = 'No file selected';
            dropzone.classList.remove('has-file');
          }
        });

        // Drag enter / over
        ['dragenter', 'dragover'].forEach(function (eventName) {
          dropzone.addEventListener(eventName, function (e) {
            e.preventDefault();
            e.stopPropagation();
            dropzone.classList.add('is-dragover');
          });
        });

        // Drag leave / end / drop
        ['dragleave', 'dragend', 'drop'].forEach(function (eventName) {
          dropzone.addEventListener(eventName, function (e) {
            e.preventDefault();
            e.stopPropagation();
            dropzone.classList.remove('is-dragover');
          });
        });

        // Handle drop
        dropzone.addEventListener('drop', function (e) {
          const files = e.dataTransfer.files;
          if (!files || !files.length) return;

          const file = files[0];
          if (file.type !== 'application/pdf') {
            fileNameEl.textContent = 'Please drop a PDF file.';
            dropzone.classList.remove('has-file');
            return;
          }

          // Attach file to hidden input so Flask can read it
          const dataTransfer = new DataTransfer();
          dataTransfer.items.add(file);
          fileInput.files = dataTransfer.files;

          fileNameEl.textContent = file.name;
          dropzone.classList.add('has-file');
        });
      }
    });
  </script>
</body>
</html>
